ğŸš€ å¼€å§‹æµ‹è¯• Permit2 ç›´æ¥ç­¾åè½¬è´¦...
ğŸ“‹ é…ç½®ä¿¡æ¯:
  ERC20åˆçº¦: 0xe7f1725E7734CE288F8367e1Bb143E90bb3F0512
  User1 (ç­¾åè€…): 0x70997970C51812dc3A010C7d01b50e0d17dc79C8
  User2 (spender): 0x3C44CdDdB6a900fa2b585dd299e03d12FA4293BC
ğŸ” æ£€æŸ¥nonceçŠ¶æ€...
ğŸ“Š NonceçŠ¶æ€ä¿¡æ¯:
  åœ°å€: 0x70997970C51812dc3A010C7d01b50e0d17dc79C8
  Nonce: 0
  çŠ¶æ€: âŒ å·²ä½¿ç”¨
  WordPos: 0
  BitPos: 0
ğŸ” ä¸º 0x70997970C51812dc3A010C7d01b50e0d17dc79C8 å¯»æ‰¾æœªä½¿ç”¨çš„nonceï¼Œä» 0 å¼€å§‹...
âœ… æ‰¾åˆ°æœªä½¿ç”¨çš„nonce: 1
ğŸ¯ æ¨èä½¿ç”¨çš„nonce: 1

ğŸ” æ£€æŸ¥åˆå§‹çŠ¶æ€...
ğŸ“Š åˆå§‹çŠ¶æ€:
  User1 ERC20ä½™é¢: 90000000000000000000
  User2 ERC20ä½™é¢: 0
ğŸ’¸ ç”Ÿæˆç­¾åå¹¶æ‰§è¡ŒPermit2ç›´æ¥è½¬è´¦...
ğŸ¯ ä¿®æ­£åçš„Permit2ç›´æ¥è°ƒç”¨æµç¨‹:
  1. User1ç­¾åæˆæƒUser2ä½œä¸ºspender (EIP712ç­¾ååŒ…å«spender)
  2. User2ç›´æ¥è°ƒç”¨Permit2çš„permitTransferFromæ–¹æ³• (å‡½æ•°å‚æ•°ä¸åŒ…å«spender)
  3. Permit2ä»msg.senderè·å–spenderï¼ŒéªŒè¯ç­¾åä¸­spenderå­—æ®µ
  4. æˆåŠŸè½¬ç§»tokenä»User1åˆ°User2

ğŸ” æ£€æŸ¥nonceçŠ¶æ€...
ğŸ“‹ ä½¿ç”¨æ¨èçš„nonce: 1
âœ… æœ€ç»ˆä½¿ç”¨çš„nonce: 1

ğŸ” EIP712ç­¾åæ•°æ® (åŒ…å«spender):
  Domain: {
  name: 'Permit2',
  chainId: 31337,
  verifyingContract: '0x5FbDB2315678afecb367f032d93F642f64180aa3'
}
  Types: {
  PermitTransferFrom: [
    { name: 'permitted', type: 'TokenPermissions' },
    { name: 'spender', type: 'address' },
    { name: 'nonce', type: 'uint256' },
    { name: 'deadline', type: 'uint256' }
  ],
  TokenPermissions: [
    { name: 'token', type: 'address' },
    { name: 'amount', type: 'uint256' }
  ]
}
  Message: {
  permitted: {
    token: '0xe7f1725E7734CE288F8367e1Bb143E90bb3F0512',
    amount: 10000000000000000000n
  },
  spender: '0x3C44CdDdB6a900fa2b585dd299e03d12FA4293BC',
  nonce: 1n,
  deadline: 1753801039n
}
  ğŸ¯ å…³é”®ï¼šEIP712ç­¾ååŒ…å«spenderå­—æ®µ

âœ… User1ç”Ÿæˆçš„ç­¾å:
0xdc37a03cb270366a274c31dc5dbb038c1a7180f2a34ba596df15583be47763521fdb15275fd95282d0e711c51f708cbe811fbac0f900b184fd533bcb44b6f1631c

ğŸš€ User2è°ƒç”¨Permit2çš„permitTransferFromæ–¹æ³•:
  è°ƒç”¨è€…: User2 (msg.senderä½œä¸ºspender)
  åˆçº¦åœ°å€: 0x5FbDB2315678afecb367f032d93F642f64180aa3
  æ–¹æ³•: permitTransferFrom
  å‚æ•°ç»“æ„:
    permit (PermitTransferFrom):
      permitted.token: 0xe7f1725E7734CE288F8367e1Bb143E90bb3F0512
      permitted.amount: 10000000000000000000
      nonce: 1
      deadline: 1753801039
      (ä¸åŒ…å«spender - ä»msg.senderè·å–)
    transferDetails (SignatureTransferDetails):
      to: 0x3C44CdDdB6a900fa2b585dd299e03d12FA4293BC
      requestedAmount: 10000000000000000000
    owner: 0x70997970C51812dc3A010C7d01b50e0d17dc79C8
    signature: 0xdc37a03cb270366a274c31dc5dbb038c1a7180f2a34ba596df15583be47763521fdb15275fd95282d0e711c51f708cbe811fbac0f900b184fd533bcb44b6f1631c

ğŸ“‹ å®Œæ•´å‘½ä»¤:
cast send --rpc-url http://127.0.0.1:8545     --private-key 0x5de4111afa1a4b94908f83103eb1f1706367c2e68ca870fc3fb9a804cdab365a     0x5FbDB2315678afecb367f032d93F642f64180aa3     "permitTransferFrom(((address,uint256),uint256,uint256),(address,uint256),address,bytes)"     "((0xe7f1725E7734CE288F8367e1Bb143E90bb3F0512,10000000000000000000),1,1753801039)"     "(0x3C44CdDdB6a900fa2b585dd299e03d12FA4293BC,10000000000000000000)"     0x70997970C51812dc3A010C7d01b50e0d17dc79C8     0xdc37a03cb270366a274c31dc5dbb038c1a7180f2a34ba596df15583be47763521fdb15275fd95282d0e711c51f708cbe811fbac0f900b184fd533bcb44b6f1631c

ğŸ”„ æ‰§è¡Œæµç¨‹:
  1. User1ç­¾åæˆæƒUser2ä¸ºspender (EIP712åŒ…å«spender)
  2. User2è°ƒç”¨Permit2.permitTransferFrom() (å‡½æ•°å‚æ•°ä¸åŒ…å«spender)
  3. Permit2éªŒè¯ç­¾åä¸­spender == msg.sender (User2)
  4. Permit2å°†User1çš„tokenè½¬ç»™User2
  5. âœ… å®Œæˆï¼ç»“æ„æ­£ç¡®

ğŸ‰ Permit2 permitTransferFromè°ƒç”¨æˆåŠŸ:

blockHash            0x991167382361710a6bc936e57770a7b54a3f49a4818f9768b40f616f4fd56d8a
blockNumber          7
contractAddress
cumulativeGasUsed    72299
effectiveGasPrice    461860875
from                 0x3C44CdDdB6a900fa2b585dd299e03d12FA4293BC
gasUsed              72299
logs                 [{"address":"0xe7f1725e7734ce288f8367e1bb143e90bb3f0512","topics":["0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef","0x00000000000000000000000070997970c51812dc3a010c7d01b50e0d17dc79c8","0x0000000000000000000000003c44cdddb6a900fa2b585dd299e03d12fa4293bc"],"data":"0x0000000000000000000000000000000000000000000000008ac7230489e80000","blockHash":"0x991167382361710a6bc936e57770a7b54a3f49a4818f9768b40f616f4fd56d8a","blockNumber":"0x7","blockTimestamp":"0x6888d33f","transactionHash":"0xfec9b2d5a89d7f8e324b1f52cf08df84f5f7d0ae073cadd5b45e670ba4236eba","transactionIndex":"0x0","logIndex":"0x0","removed":false}]
logsBloom            0x00000000000000000002000000000000000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000100000000000000000000000000008000000000000000000000000000000000000000000000800000000000000000000000000000800000000000000000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000002000000000000000000001000000000000000000000000000000000000000000000000000000000000000000001000000000000800000000000000000
root
status               1 (success)
transactionHash      0xfec9b2d5a89d7f8e324b1f52cf08df84f5f7d0ae073cadd5b45e670ba4236eba
transactionIndex     0
type                 2
blobGasPrice         1
blobGasUsed
to                   0x5FbDB2315678afecb367f032d93F642f64180aa3

âœ… gen_and_send_signature_direct.tsæ‰§è¡Œå®Œæˆ
ğŸ” æ£€æŸ¥æœ€ç»ˆçŠ¶æ€...
ğŸ“Š æœ€ç»ˆçŠ¶æ€:
  User1 ERC20ä½™é¢: 80000000000000000000
  User2 ERC20ä½™é¢: 10000000000000000000
âœ… éªŒè¯ç»“æœ...
âœ… User1 ERC20ä½™é¢æ­£ç¡®: å‡å°‘äº†10ä¸ªtoken
âœ… User2 ERC20ä½™é¢æ­£ç¡®: å¢åŠ äº†10ä¸ªtoken
âœ… æ€»ä¾›åº”é‡å®ˆæ’: User1å‡å°‘çš„ = User2å¢åŠ çš„
ğŸ‰ Permit2ç›´æ¥è½¬è´¦æµ‹è¯•å®Œæˆ!
ğŸ“ æµç¨‹æ€»ç»“:
  1. User1ç­¾åæˆæƒUser2ä¸ºspender
  2. User2ç›´æ¥è°ƒç”¨Permit2.permitTransferFrom()
  3. Permit2éªŒè¯ç­¾åå¹¶è½¬ç§»token
  4. âœ… æ— éœ€TokenBankå‚ä¸ï¼Œç®€åŒ–äº†æµç¨‹
