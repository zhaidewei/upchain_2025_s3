./initialize_3_3.sh
🚀 开始初始化 Permit2 TokenBank 测试环境...
📋 账户信息:
  Admin: 0xf39Fd6e51aad88F6F4ce6aB8827279cffFb92266
  User1: 0x70997970c51812dc3a010c7d01b50e0d17dc79c8
  User2: 0x3C44CdDdB6a900fa2b585dd299e03d12FA4293BC
🔧 检查anvil是否运行...
✅ Anvil已运行
🔨 编译合约...
[⠊] Compiling...
No files changed, compilation skipped
✅ 编译成功
🔐 部署MyPermit2合约...
✅ MyPermit2合约部署到: 0x5FbDB2315678afecb367f032d93F642f64180aa3
📦 部署ERC20合约...
✅ ERC20合约部署到: 0xe7f1725E7734CE288F8367e1Bb143E90bb3F0512
🏦 部署TokenBank合约...
✅ TokenBank合约部署到: 0x9fe46736679d2d9a65f0992f2272de9f3c7fa6e0
💰 检查admin的初始余额...
✅ Admin初始余额: 1000000000000000000000 [1e21] (应该是1000000000000000000000)
💸 Admin给User1转账100个token...

blockHash            0x401d81038391cfe926d1879335af03a2515917e0b6b5ea09477853e0761bab27
blockNumber          4
contractAddress
cumulativeGasUsed    51252
effectiveGasPrice    687746790
from                 0xf39Fd6e51aad88F6F4ce6aB8827279cffFb92266
gasUsed              51252
logs                 [{"address":"0xe7f1725e7734ce288f8367e1bb143e90bb3f0512","topics":["0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef","0x000000000000000000000000f39fd6e51aad88f6f4ce6ab8827279cfffb92266","0x00000000000000000000000070997970c51812dc3a010c7d01b50e0d17dc79c8"],"data":"0x0000000000000000000000000000000000000000000000056bc75e2d63100000","blockHash":"0x401d81038391cfe926d1879335af03a2515917e0b6b5ea09477853e0761bab27","blockNumber":"0x4","blockTimestamp":"0x6888c37e","transactionHash":"0xd41627eefe2b7675d383325a3a99ed72f49a941cb053f2056b1bc4b723ef0a9b","transactionIndex":"0x0","logIndex":"0x0","removed":false}]
logsBloom            0x00000000000000000002000000000000000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000008000000000000000000000000000000000000000000000800000000000000000100000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002000000200000000000001000000000002000000000000000000000000000000000000000000000000000000001000000000000800000000000000000
root
status               1 (success)
transactionHash      0xd41627eefe2b7675d383325a3a99ed72f49a941cb053f2056b1bc4b723ef0a9b
transactionIndex     0
type                 2
blobGasPrice         1
blobGasUsed
to                   0xe7f1725E7734CE288F8367e1Bb143E90bb3F0512
✅ User1获得100个token
🔐 User1 approve Permit2合约max值...

blockHash            0xeca08153760f46152988d367363e1aab160d68f1aed7aadb0924b51ae8c161d3
blockNumber          5
contractAddress
cumulativeGasUsed    46269
effectiveGasPrice    602072179
from                 0x70997970c51812dc3a010c7d01b50e0d17dc79c8
gasUsed              46269
logs                 [{"address":"0xe7f1725e7734ce288f8367e1bb143e90bb3f0512","topics":["0x8c5be1e5ebec7d5bd14f71427d1e84f3dd0314c0f7b2291e5b200ac8c7c3b925","0x00000000000000000000000070997970c51812dc3a010c7d01b50e0d17dc79c8","0x0000000000000000000000005fbdb2315678afecb367f032d93f642f64180aa3"],"data":"0xffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff","blockHash":"0xeca08153760f46152988d367363e1aab160d68f1aed7aadb0924b51ae8c161d3","blockNumber":"0x5","blockTimestamp":"0x6888c37e","transactionHash":"0xfd00cb3bb27c0fa14460fd4615504a5679c9be1a59410c40e2dae0895dd248f0","transactionIndex":"0x0","logIndex":"0x0","removed":false}]
logsBloom            0x00000000000000000002000000000000000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000200000000000000000000000000000000000000000000000000000000000000000000000000800000000000000000000800000000004000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001000000000000008000000000000000000000010000000000000000000000000000001000000000000800000000000000000
root
status               1 (success)
transactionHash      0xfd00cb3bb27c0fa14460fd4615504a5679c9be1a59410c40e2dae0895dd248f0
transactionIndex     0
type                 2
blobGasPrice         1
blobGasUsed
to                   0xe7f1725E7734CE288F8367e1Bb143E90bb3F0512
✅ User1已approve Permit2合约
🔍 验证初始状态...
  User1在TokenBank余额: 0x0000000000000000000000000000000000000000000000000000000000000000 (应该是0)
  User1在ERC20余额: 100000000000000000000 [1e20] (应该是100000000000000000000)
  TokenBank总余额: 0 (应该是0)
  User1对Permit2的allowance: 115792089237316195423570985008687907853269984665640564039457584007913129639935 [1.157e77] (应该是max值)

🎉 初始化完成！

📋 合约地址:
  ERC20: 0xe7f1725E7734CE288F8367e1Bb143E90bb3F0512
  TokenBank: 0x9fe46736679d2d9a65f0992f2272de9f3c7fa6e0
  Permit2: 0x5FbDB2315678afecb367f032d93F642f64180aa3

👥 测试账户:
  Admin: 0xf39Fd6e51aad88F6F4ce6aB8827279cffFb92266
  User1: 0x70997970c51812dc3a010c7d01b50e0d17dc79c8
  User2: 0x3C44CdDdB6a900fa2b585dd299e03d12FA4293BC

💡 下一步: 使用User1构造EIP712签名进行depositWithPermit2测试

🔧 环境变量已设置，可以在其他脚本中使用:
  export ERC20_ADDRESS=0xe7f1725E7734CE288F8367e1Bb143E90bb3F0512
  export TOKENBANK_ADDRESS=0x9fe46736679d2d9a65f0992f2272de9f3c7fa6e0
  export PERMIT2_ADDRESS=0x5FbDB2315678afecb367f032d93F642f64180aa3
