ğŸš€ å¼€å§‹æµ‹è¯• TokenBank depositWithPermit2 è½¬è´¦...
ğŸ“‹ é…ç½®ä¿¡æ¯:
  ERC20åˆçº¦: 0xe7f1725E7734CE288F8367e1Bb143E90bb3F0512
  TokenBankåˆçº¦: 0x9fe46736679d2d9a65f0992f2272de9f3c7fa6e0
  User1 (ç­¾åè€…): 0x70997970c51812dc3a010c7d01b50e0d17dc79c8
ğŸ” æ£€æŸ¥nonceçŠ¶æ€...
ğŸ“Š NonceçŠ¶æ€ä¿¡æ¯:
  åœ°å€: 0x70997970c51812dc3a010c7d01b50e0d17dc79c8
  Nonce: 0
  çŠ¶æ€: âœ… æœªä½¿ç”¨
  WordPos: 0
  BitPos: 0
ğŸ” ä¸º 0x70997970c51812dc3a010c7d01b50e0d17dc79c8 å¯»æ‰¾æœªä½¿ç”¨çš„nonceï¼Œä» 0 å¼€å§‹...
âœ… æ‰¾åˆ°æœªä½¿ç”¨çš„nonce: 0
ğŸ¯ æ¨èä½¿ç”¨çš„nonce: 0

ğŸ” æ£€æŸ¥åˆå§‹çŠ¶æ€...
ğŸ“Š åˆå§‹çŠ¶æ€:
  User1 ERC20ä½™é¢: 100000000000000000000
  TokenBank ERC20ä½™é¢: 0
  User1åœ¨TokenBankå­˜æ¬¾ä½™é¢: 0
ğŸ’¸ ç”Ÿæˆç­¾åå¹¶æ‰§è¡ŒTokenBank depositWithPermit2...
ğŸ¯ TokenBank depositWithPermit2 æµç¨‹:
  1. User1ç­¾åæˆæƒTokenBankä½œä¸ºspender (EIP712ç­¾ååŒ…å«spender)
  2. User1è°ƒç”¨TokenBankçš„depositWithPermit2æ–¹æ³•
  3. TokenBankè°ƒç”¨Permit2.permitTransferFrom()
  4. Permit2éªŒè¯ç­¾åå¹¶å°†tokenä»User1è½¬åˆ°TokenBank
  5. TokenBankæ›´æ–°User1çš„å­˜æ¬¾ä½™é¢

ğŸ” æ£€æŸ¥nonceçŠ¶æ€...
ğŸ“‹ ä½¿ç”¨æ¨èçš„nonce: 0
âœ… æœ€ç»ˆä½¿ç”¨çš„nonce: 0

ğŸ” EIP712ç­¾åæ•°æ® (åŒ…å«TokenBankä½œä¸ºspender):
  Domain: {
  name: 'Permit2',
  chainId: 31337,
  verifyingContract: '0x5FbDB2315678afecb367f032d93F642f64180aa3'
}
  Types: {
  PermitTransferFrom: [
    { name: 'permitted', type: 'TokenPermissions' },
    { name: 'spender', type: 'address' },
    { name: 'nonce', type: 'uint256' },
    { name: 'deadline', type: 'uint256' }
  ],
  TokenPermissions: [
    { name: 'token', type: 'address' },
    { name: 'amount', type: 'uint256' }
  ]
}
  Message: {
  permitted: {
    token: '0xe7f1725E7734CE288F8367e1Bb143E90bb3F0512',
    amount: 10000000000000000000n
  },
  spender: '0x9fe46736679d2d9a65f0992f2272de9f3c7fa6e0',
  nonce: 0n,
  deadline: 1753800981n
}
  ğŸ¯ å…³é”®ï¼šEIP712ç­¾ååŒ…å«TokenBankä½œä¸ºspenderå­—æ®µ

âœ… User1ç”Ÿæˆçš„ç­¾å:
0xb7811a423c0426af261ffc610eb6fdeb9cf4add14944e3781b38705f6323138a667bdb5c98677dac5ca65cb17f0b4530a7d5caf6f7b8b819c941e9ae0d218c491b

ğŸš€ User1è°ƒç”¨TokenBankçš„depositWithPermit2æ–¹æ³•:
  è°ƒç”¨è€…: User1 (msg.sender)
  åˆçº¦åœ°å€: 0x9fe46736679d2d9a65f0992f2272de9f3c7fa6e0
  æ–¹æ³•: depositWithPermit2
  å‚æ•°:
    owner: 0x70997970c51812dc3a010c7d01b50e0d17dc79c8
    amount: 10000000000000000000
    deadline: 1753800981
    nonce: 0
    signature: 0xb7811a423c0426af261ffc610eb6fdeb9cf4add14944e3781b38705f6323138a667bdb5c98677dac5ca65cb17f0b4530a7d5caf6f7b8b819c941e9ae0d218c491b

ğŸ“‹ å®Œæ•´å‘½ä»¤:
cast send --rpc-url http://127.0.0.1:8545     --private-key 0x59c6995e998f97a5a0044966f0945389dc9e86dae88c7a8412f4603b6b78690d     0x9fe46736679d2d9a65f0992f2272de9f3c7fa6e0     "depositWithPermit2(address,uint256,uint256,uint256,bytes)"     0x70997970c51812dc3a010c7d01b50e0d17dc79c8     10000000000000000000     1753800981     0     0xb7811a423c0426af261ffc610eb6fdeb9cf4add14944e3781b38705f6323138a667bdb5c98677dac5ca65cb17f0b4530a7d5caf6f7b8b819c941e9ae0d218c491b

ğŸ”„ æ‰§è¡Œæµç¨‹:
  1. User1ç­¾åæˆæƒTokenBankä¸ºspender (EIP712åŒ…å«TokenBank)
  2. User1è°ƒç”¨TokenBank.depositWithPermit2()
  3. TokenBankè°ƒç”¨Permit2.permitTransferFrom()
  4. Permit2éªŒè¯ç­¾åä¸­spender == TokenBank
  5. Permit2å°†User1çš„tokenè½¬ç»™TokenBank
  6. TokenBankæ›´æ–°User1çš„å­˜æ¬¾ä½™é¢
  7. âœ… å®Œæˆï¼é€šè¿‡TokenBankè¿›è¡Œå­˜æ¬¾

ğŸ‰ TokenBank depositWithPermit2è°ƒç”¨æˆåŠŸ:

blockHash            0x9eb75ab9e2d13753125024e687db6e441bcaacbbb22fd6248ae73ebe7dc4d0b6
blockNumber          6
contractAddress
cumulativeGasUsed    158522
effectiveGasPrice    527045301
from                 0x70997970c51812dc3a010c7d01b50e0d17dc79c8
gasUsed              158522
logs                 [{"address":"0xe7f1725e7734ce288f8367e1bb143e90bb3f0512","topics":["0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef","0x00000000000000000000000070997970c51812dc3a010c7d01b50e0d17dc79c8","0x0000000000000000000000009fe46736679d2d9a65f0992f2272de9f3c7fa6e0"],"data":"0x0000000000000000000000000000000000000000000000008ac7230489e80000","blockHash":"0x9eb75ab9e2d13753125024e687db6e441bcaacbbb22fd6248ae73ebe7dc4d0b6","blockNumber":"0x6","blockTimestamp":"0x6888d305","transactionHash":"0x96c838680952c51798c7324b5656244330a177f2a15f4ee99d3150bd79f06ed2","transactionIndex":"0x0","logIndex":"0x0","removed":false},{"address":"0x9fe46736679d2d9a65f0992f2272de9f3c7fa6e0","topics":["0xe391e632f0c535fb9543412b49a49299087c915a9020b721a5dc29560e769930","0x00000000000000000000000070997970c51812dc3a010c7d01b50e0d17dc79c8"],"data":"0x0000000000000000000000000000000000000000000000008ac7230489e80000","blockHash":"0x9eb75ab9e2d13753125024e687db6e441bcaacbbb22fd6248ae73ebe7dc4d0b6","blockNumber":"0x6","blockTimestamp":"0x6888d305","transactionHash":"0x96c838680952c51798c7324b5656244330a177f2a15f4ee99d3150bd79f06ed2","transactionIndex":"0x0","logIndex":"0x1","removed":false}]
logsBloom            0x00000000000000000002000000000000000000000000000000000000000000000000000000000000000400000000000010400000000040200000000000000000000000000000000000000008000000100000000000000000000000000000400000080800000000000000000000000010000000000000000000000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002000000000000000000001000000000000000000000000000000000000000000000000000000000000000000001000000000000c00000000000000000
root
status               1 (success)
transactionHash      0x96c838680952c51798c7324b5656244330a177f2a15f4ee99d3150bd79f06ed2
transactionIndex     0
type                 2
blobGasPrice         1
blobGasUsed
to                   0x9fe46736679d2d9a65f0992f2272de9f3c7fa6e0

âœ… gen_and_send_signature_via_tokenBank.tsæ‰§è¡Œå®Œæˆ
ğŸ” æ£€æŸ¥æœ€ç»ˆçŠ¶æ€...
ğŸ“Š æœ€ç»ˆçŠ¶æ€:
  User1 ERC20ä½™é¢: 90000000000000000000
  TokenBank ERC20ä½™é¢: 10000000000000000000
  User1åœ¨TokenBankå­˜æ¬¾ä½™é¢: 10000000000000000000
âœ… éªŒè¯ç»“æœ...
âœ… User1 ERC20ä½™é¢æ­£ç¡®: å‡å°‘äº†10ä¸ªtoken
âœ… TokenBank ERC20ä½™é¢æ­£ç¡®: å¢åŠ äº†10ä¸ªtoken
âœ… User1åœ¨TokenBankå­˜æ¬¾ä½™é¢æ­£ç¡®: å¢åŠ äº†10ä¸ªtoken
âœ… æ€»ä¾›åº”é‡å®ˆæ’: User1å‡å°‘çš„ = TokenBankå¢åŠ çš„
ğŸ‰ TokenBank depositWithPermit2æµ‹è¯•å®Œæˆ!
ğŸ“ æµç¨‹æ€»ç»“:
  1. User1ç­¾åæˆæƒTokenBankä¸ºspender
  2. User1è°ƒç”¨TokenBank.depositWithPermit2()
  3. TokenBankè°ƒç”¨Permit2.permitTransferFrom()
  4. Permit2éªŒè¯ç­¾åå¹¶è½¬ç§»tokenåˆ°TokenBank
  5. TokenBankæ›´æ–°User1çš„å­˜æ¬¾ä½™é¢
  6. âœ… é€šè¿‡TokenBankè¿›è¡Œå­˜æ¬¾ï¼Œæ— éœ€é¢„å…ˆapprove
